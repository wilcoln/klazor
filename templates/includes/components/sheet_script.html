{% load static %}
<script src="{% static 'marked/lib/marked.js' %}"></script>
<script src="{% static 'vue/dist/vue.min.js' %}"></script>
<script src="{% static 'js/contents.js' %}"></script>
<script>
    // Enabling devtools


    Vue.config.devtools = true

    let title = `{{ sheet.title }}`
    let contents = []
    let text = ""
    let text_marked = ""

    {% for content in sheet.content_set.all  %}
        {% if content.videocontent %}
            contents.push(new VideoContent(title, `{{ content.videocontent.video.url }}`))
        {% elif content.audiocontent %}
            contents.push(new AudioContent(title, `{{ content.audiocontent.audio.url }}`))
        {% elif content.imagecontent %}
            contents.push(new ImageContent(title, `{{ content.imagecontent.image.url }}`))
        {% elif content.markdowncontent %}
            text = `{{ content.markdowncontent.text|safe }}`
            text_marked = marked(text)
            document.getElementById('id_{{ content.id }}').innerHTML = text_marked
            contents.push(new MarkdownContent(text))
        {% endif %}
    {% endfor %}


    //-----------

    // DÃ©finition des classes

    let vue = new Vue({
        el: "#sheet",
        data:{
                title: title,
                contents: contents,
                editMode: true,
        },
        methods:{
            toggleMode: function ()  {
                this.editMode = !this.editMode
            }
        }
    })

    Vue.component('markdown-content',{
        template: "#markdown-content",
        props: ['content'],
        data: () => {
            return {
                text: content.text
            }
        },
        methods:{

        },
        computed:{
            html: () => this.text
        }
    })

    Vue.component('video-content',{
        template: "#video-content",
        props: ['content'],
        data: () => {
            return {
                title: content.title,
                video: content.video
            }
        },
        methods:{

        }
    })

    Vue.component('audio-content',{
        template: "#audio-content",
        props: ['content'],
        data: () => {
            return {
                title: content.title,
                audio: content.audio
            }
        },
        methods:{

        }
    })

    Vue.component('image-content',{
        template: "#image-content",
        props: ['content'],
        data: () => {
            return {
                title: content.title,
                image: content.image
            }
        },
        methods:{

        }
    })

</script>